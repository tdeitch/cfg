#!/bin/bash
set -e

# git-pr
# Call "hub pull-request" to submit a PR, but push to `origin` first and prompt
# for the PR message ahead of time.

function main {
  editor=$(get_editor)
  tmpfile=$(mktemp)

  git show -s --format=%s > $tmpfile
  eval $editor $tmpfile
  echo "PR message:"
  cat $tmpfile
  git push origin HEAD
  echo hub pull-request -F "$tmpfile"
  hub pull-request -F "$tmpfile"
}

function get_editor {
  if git config core.editor; then
    git config core.editor
  elif [ -z "$EDITOR" ]; then
    (>&2 echo "Must set an editor!")
    exit 1
  else
    echo "$EDITOR"
  fi
}

main
